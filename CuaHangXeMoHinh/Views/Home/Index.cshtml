@using System.Linq
@using CuaHangXeMoHinh.Data
@inject ApplicationDbContext _context
@model List<CuaHangXeMoHinh.Models.Product>
@{
    ViewData["Title"] = "4T Racing";
    
    // Dynamic Category IDs lookup
    var supercarId = _context.Categories.FirstOrDefault(c => c.Name.Contains("Super") || c.Name.Contains("Sieu"))?.Id ?? 0;
    var classicId = _context.Categories.FirstOrDefault(c => c.Name.Contains("Classic") || c.Name.Contains("Co"))?.Id ?? 0;
    var racingId = _context.Categories.FirstOrDefault(c => c.Name.Contains("Racing") || c.Name.Contains("Dua"))?.Id ?? 0;
}
@Html.AntiForgeryToken()

<!-- Custom Styles for WOW Factor -->
<style>
    /* Ken Burns Background */
    .ken-burns-bg {
        animation: kenBurns 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
    }
    @@keyframes kenBurns {
        0% { transform: scale(1) translate(0, 0); }
        100% { transform: scale(1.15) translate(-2%, -1%); }
    }
    
    /* Text Stroke Effect */
    .text-stroke {
        -webkit-text-stroke: 1px rgba(255, 255, 255, 0.2);
        color: transparent;
    }
    
    /* Slanted Clip Paths */
    .clip-slant-left {
        clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
    }
    .clip-slant-right {
        clip-path: polygon(15% 0, 100% 0, 100% 100%, 0% 100%);
    }
    
    /* Horizontal Scroll Hide */
    .scroll-track {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none;  /* IE 10+ */
    }
    .scroll-track::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    /* Glass Panel */
    .glass-panel {
        background: rgba(9, 9, 11, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* 3D Card Effects */
    .card-3d-wrapper {
        perspective: 1000px;
    }
    .card-3d {
        transform-style: preserve-3d;
        transition: transform 0.1s ease-out;
    }
    .card-content {
        transform: translateZ(30px);
    }
    .card-bg-layer {
         transform: translateZ(0px);
    }
</style>

<!-- HERO SECTION -->
<div class="relative h-screen w-full overflow-hidden bg-zinc-950">
    <!-- Animated Background Carousel -->
    <div id="hero-carousel" class="absolute inset-0 z-0 opacity-60 pointer-events-none">
        <!-- Slide 1: Aston Martin (Dark & Moody) -->
        <img src="https://images.unsplash.com/photo-1494976388531-d1058494cdd8?q=80&w=2670&auto=format&fit=crop" 
             class="hero-slide absolute inset-0 w-full h-full object-cover ken-burns-bg transition-opacity duration-[2000ms] opacity-100" 
             alt="Aston Martin">
             
        <!-- Slide 2: Porsche (Classic) -->
        <img src="https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?q=80&w=2670&auto=format&fit=crop" 
             class="hero-slide absolute inset-0 w-full h-full object-cover ken-burns-bg transition-opacity duration-[2000ms] opacity-0" 
             alt="Porsche 911">

        <!-- Slide 3: McLaren (Aggressive) -->
        <img src="https://images.unsplash.com/photo-1544636331-e26879cd4d9b?q=80&w=2670&auto=format&fit=crop" 
             class="hero-slide absolute inset-0 w-full h-full object-cover ken-burns-bg transition-opacity duration-[2000ms] opacity-0" 
             alt="McLaren">

        <!-- Slide 4: Ferrari (Red) -->
        <img src="https://images.unsplash.com/photo-1583121274602-3e2820c69888?q=80&w=2670&auto=format&fit=crop" 
             class="hero-slide absolute inset-0 w-full h-full object-cover ken-burns-bg transition-opacity duration-[2000ms] opacity-0" 
             alt="Ferrari">

        <!-- Slide 5: The Void (Pure minimal black) -->
        <div class="hero-slide absolute inset-0 w-full h-full bg-zinc-950 transition-opacity duration-[2000ms] opacity-0"></div>

        <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 via-zinc-950/40 to-transparent"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(9,9,11,1)_120%)]"></div>
    </div>

    <!-- Floating Grid (Three.js Vibe) -->
    <div class="absolute inset-0 z-0 opacity-20 pointer-events-none" 
         style="background-image: radial-gradient(rgba(239, 68, 68, 0.3) 1px, transparent 1px); background-size: 50px 50px; transform: perspective(1000px) rotateX(60deg) translateY(-100px) scale(2);">
    </div>

    <!-- Content -->
    <div class="relative z-10 h-full flex flex-col justify-center items-center text-center px-4" id="hero-content">
        <p class="text-primary font-bold tracking-[0.6em] text-sm md:text-base animate-fade-in-up mb-6 uppercase drop-shadow-xl">
            Define Your Legacy
        </p>
        <div class="relative mb-8">
            <h1 class="text-6xl md:text-9xl font-display font-black text-white leading-none tracking-tighter mix-blend-overlay opacity-90 relative z-10">
                <span class="block hover:text-primary transition-colors duration-500 cursor-default" id="hero-title-1">PURE</span>
            </h1>
            <h1 class="absolute top-1 left-1 text-6xl md:text-9xl font-display font-black text-transparent text-stroke leading-none tracking-tighter opacity-50 z-0">
                PURE
            </h1>
        </div>
        
        <div class="relative mb-12">
             <h1 class="text-6xl md:text-9xl font-display font-black text-transparent bg-clip-text bg-gradient-to-r from-white via-zinc-200 to-zinc-500 leading-none tracking-tighter relative z-10">
                <span class="block" id="hero-title-2">ADRENALINE</span>
            </h1>
            <!-- Glow Effect -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-primary/20 blur-[100px] z-0 pointer-events-none"></div>
        </div>

        <div class="flex flex-col md:flex-row gap-6 mt-8">
            <a href="/Products" class="group relative px-10 py-5 bg-primary overflow-hidden clip-path-slant shadow-[0_0_30px_rgba(239,68,68,0.4)] hover:shadow-[0_0_50px_rgba(239,68,68,0.6)] transition-all duration-300">
                <div class="absolute inset-0 w-full h-full bg-black/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                <span class="relative font-display font-bold text-white tracking-widest uppercase flex items-center gap-3 text-lg">
                    Start Collection <i class="bi bi-arrow-right group-hover:translate-x-2 transition-transform"></i>
                </span>
            </a>
            <a href="#featured" class="px-10 py-5 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all duration-300 uppercase tracking-widest font-bold clip-path-slant glass-panel hover:bg-white/5">
                NEW ARRIVALS
            </a>
        </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="absolute bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-20 opacity-60 animate-bounce">
        <span class="text-[10px] uppercase tracking-[0.3em] text-zinc-400">Scroll to Explore</span>
        <i class="bi bi-chevron-down text-zinc-400"></i>
    </div>
</div>

<!-- MARQUEE BRAND SECTION -->
<div class="py-6 bg-black border-y border-zinc-900 overflow-hidden relative z-20">
    <div class="flex gap-24 animate-marquee whitespace-nowrap items-center opacity-40 hover:opacity-100 transition-opacity duration-500">
        <span class="text-4xl font-display font-black text-white italic">FERRARI</span>
        <span class="text-4xl font-display font-black text-transparent text-stroke stroke-white">LAMBORGHINI</span>
        <span class="text-4xl font-display font-black text-white italic">PORSCHE</span>
        <span class="text-4xl font-display font-black text-transparent text-stroke stroke-white">MCLAREN</span>
        <span class="text-4xl font-display font-black text-white italic">BUGATTI</span>
        <span class="text-4xl font-display font-black text-transparent text-stroke stroke-white">ASTON MARTIN</span>
        <!-- Duplicate for loop -->
        <span class="text-4xl font-display font-black text-white italic">FERRARI</span>
        <span class="text-4xl font-display font-black text-transparent text-stroke stroke-white">LAMBORGHINI</span>
        <span class="text-4xl font-display font-black text-white italic">PORSCHE</span>
        <span class="text-4xl font-display font-black text-transparent text-stroke stroke-white">MCLAREN</span>
    </div>
</div>

<!-- ASYMMETRIC CATEGORIES (Breaking the Grid) -->
<div class="relative py-32 bg-zinc-950 overflow-hidden">
    <!-- Big Background Text Parallax -->
    <div class="absolute top-20 right-0 opacity-5 pointer-events-none select-none">
        <h2 class="text-[25vw] font-black text-white leading-none tracking-tighter select-none" id="bg-text-parallax">CATEGORIES</h2>
    </div>

    <div class="container mx-auto px-4 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 min-h-[700px]">
            
            <!-- Item 1: Large Left with Tilt -->
            <div class="md:col-span-7 relative group card-3d-wrapper h-full">
                <div class="card-3d w-full h-full relative overflow-hidden bg-zinc-900 border border-zinc-800">
                    <div class="absolute inset-0 bg-red-900/10 group-hover:bg-red-900/20 transition-colors z-10"></div>
                    <img src="https://images.unsplash.com/photo-1544636331-e26879cd4d9b?q=80&w=2574&auto=format&fit=crop" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-1000 scale-100 group-hover:scale-110 card-bg-layer" alt="Supercars">
                    
                    <div class="card-content absolute bottom-0 left-0 p-10 z-20 w-full bg-gradient-to-t from-black/90 to-transparent">
                        <h3 class="text-6xl md:text-8xl font-display font-bold text-white mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 italic">SUPERCARS</h3>
                         <div class="h-1 w-0 group-hover:w-24 bg-primary transition-all duration-500 mb-4"></div>
                        <div class="text-primary font-bold tracking-widest opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100 flex items-center gap-2 text-lg">
                            EXPLORE COLLECTION <i class="bi bi-arrow-right"></i>
                        </div>
                    </div>
                    <!-- Full Card Link -->
                    <a href="/Products?categoryId=@supercarId" class="absolute inset-0 z-30"></a>
                </div>
            </div>

            <!-- Item 2 & 3: Stacked Right -->
            <div class="md:col-span-5 flex flex-col gap-6">
                <div class="h-1/2 relative group card-3d-wrapper">
                     <div class="card-3d w-full h-full relative overflow-hidden bg-zinc-900 border border-zinc-800">
                         <img src="https://images.unsplash.com/photo-1583121274602-3e2820c69888?q=80&w=2670&auto=format&fit=crop" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 scale-100 group-hover:scale-110" alt="Classic">
                         <div class="absolute inset-0 bg-black/40 group-hover:bg-black/10 transition-colors duration-500"></div>
                         <div class="card-content absolute bottom-0 left-0 p-8 z-20">
                            <h3 class="text-4xl font-display font-bold text-white mb-1 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">CLASSIC</h3>
                            <p class="text-zinc-400 text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-500">Timeless elegance reborn</p>
                        </div>
                        <a href="/Products?categoryId=@classicId" class="absolute inset-0 z-30"></a>
                     </div>
                </div>
                <div class="h-1/2 relative group card-3d-wrapper">
                    <div class="card-3d w-full h-full relative overflow-hidden bg-zinc-900 border border-zinc-800">
                        <img src="https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=2670&auto=format&fit=crop" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 scale-100 group-hover:scale-110" alt="Racing">
                         <div class="absolute inset-0 bg-black/40 group-hover:bg-black/10 transition-colors duration-500"></div>
                        <div class="card-content absolute bottom-0 left-0 p-8 z-20">
                            <h3 class="text-4xl font-display font-bold text-white mb-1 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 text-transparent text-stroke stroke-white group-hover:text-white group-hover:stroke-0">RACING</h3>
                             <p class="text-zinc-400 text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-500">Track ready beasts</p>
                        </div>
                         <a href="/Products?categoryId=@racingId" class="absolute inset-0 z-30"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- FEATURED SHOWROOM (Horizontal Scroll + 3D) -->
<div class="bg-zinc-950 py-32 border-t border-zinc-900 border-b border-zinc-900 relative" id="featured">
    <div class="container mx-auto px-4 mb-8 flex flex-col md:flex-row justify-between items-end gap-8">
        <div>
            <h4 class="text-primary font-bold tracking-[0.3em] uppercase mb-2 animate-pulse text-sm">PREMIUM COLLECTION</h4>
            <h2 class="text-4xl md:text-6xl font-display font-bold text-white leading-none">NEW ARRIVALS</h2>
        </div>
        

    </div>

    <!-- Scroll Track -->
    <div class="overflow-x-auto scroll-track px-4 md:px-0 pb-10" id="showroom-track">
        <div class="flex gap-8 container mx-auto w-max">
            @if (Model != null && Model.Any())
            {
                @foreach (var item in Model)
                {
                    <div class="card-3d-wrapper w-[300px] md:w-[380px] h-[520px] group relative product-card">
                        <!-- Hidden Quantity Input for JS -->
                        <input type="hidden" class="quantity-input" value="1">
                        
                        <!-- 3D Card Container -->
                        <div class="card-3d relative w-full h-full bg-zinc-900 border border-zinc-800 hover:border-zinc-600 shadow-2xl overflow-hidden rounded-none clip-path-slant-right transition-all duration-300">
                            
                            <!-- Image Layer (Clickable) -->
                            <div class="absolute inset-0 z-0 bg-zinc-950 h-[70%]">
                                <a asp-controller="Products" asp-action="Detail" asp-route-id="@item.Id" class="block w-full h-full cursor-pointer">
                                    <img src="@(item.Images?.FirstOrDefault(i => i.IsPrimary)?.Url ?? "https://images.unsplash.com/photo-1617788138017-80ad40651399?q=80&w=2670&auto=format&fit=crop")" 
                                         class="w-full h-full object-cover group-hover:scale-110 transition-all duration-700" 
                                         alt="@item.Name">
                                    <div class="absolute inset-0 bg-gradient-to-t from-zinc-900 via-transparent to-transparent opacity-90"></div>
                                </a>
                            </div>

                            <!-- Content Layer -->
                            <div class="card-content absolute bottom-0 left-0 w-full p-8 z-10 bg-gradient-to-t from-zinc-900 via-zinc-900/90 to-transparent h-[40%] flex flex-col justify-end">
                                <div class="flex items-center gap-3 mb-2">
                                     @if(item.Stock > 0) {
                                        <span class="px-2 py-1 bg-green-500/10 text-green-400 text-[10px] uppercase font-bold border border-green-500/20">In Stock</span>
                                     } else {
                                        <span class="px-2 py-1 bg-red-500/10 text-red-400 text-[10px] uppercase font-bold border border-red-500/20">Sold Out</span>
                                     }
                                     <span class="text-zinc-500 text-xs uppercase tracking-wider">@(item.Brand?.Name ?? "Luxury")</span>
                                </div>
                                
                                <!-- Title Link -->
                                <a asp-controller="Products" asp-action="Detail" asp-route-id="@item.Id" class="hover:text-primary transition-colors block">
                                    <h3 class="text-2xl font-display font-bold text-white mb-3 leading-tight line-clamp-2">@item.Name</h3>
                                </a>
                                
                                <div class="flex justify-between items-end border-t border-white/10 pt-4 mt-2">
                                    <div>
                                        <p class="text-zinc-500 text-xs uppercase mb-1">Price</p>
                                        <p class="text-xl text-primary font-bold">@item.Price.ToString("N0") đ</p>
                                    </div>
                                    
                                    <!-- AJAX Add to Cart Button (Completely isolated) -->
                                    <button class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center hover:bg-primary hover:text-white hover:scale-110 transition-all duration-300 shadow-lg add-to-cart-btn z-50 cursor-pointer"
                                            data-product-id="@item.Id"
                                            data-product-name="@item.Name" 
                                            data-id="@item.Id">
                                        <i class="bi bi-bag-plus text-lg pointer-events-none"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else 
            {
               <div class="w-full text-center text-white p-10">No products found.</div>
            }
        </div>
    </div>
</div>

<!-- Why Choose Us - Tech Specs Style -->
<div class="py-24 bg-zinc-950 relative overflow-hidden border-t border-zinc-900">
    <div class="container mx-auto px-4 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-0 border border-zinc-800 divide-y md:divide-y-0 md:divide-x divide-zinc-800">
            <div class="p-12 hover:bg-zinc-900 transition-colors group text-center">
                <i class="bi bi-shield-check text-5xl text-zinc-600 group-hover:text-primary transition-colors mb-6 block"></i>
                <h3 class="text-white font-display font-bold text-xl mb-4">AUTHENTIC 100%</h3>
                <p class="text-zinc-500 leading-relaxed text-sm">Certified original models from top manufacturers globally.</p>
            </div>
            <div class="p-12 hover:bg-zinc-900 transition-colors group text-center">
                <i class="bi bi-box-seam-fill text-5xl text-zinc-600 group-hover:text-primary transition-colors mb-6 block"></i>
                <h3 class="text-white font-display font-bold text-xl mb-4">PREMIUM SHIPPING</h3>
                <p class="text-zinc-500 leading-relaxed text-sm">Triple-layer shockproof packaging for absolute safety.</p>
            </div>
             <div class="p-12 hover:bg-zinc-900 transition-colors group text-center">
                <i class="bi bi-stars text-5xl text-zinc-600 group-hover:text-primary transition-colors mb-6 block"></i>
                <h3 class="text-white font-display font-bold text-xl mb-4">LIFETIME SUPPORT</h3>
                <p class="text-zinc-500 leading-relaxed text-sm">Expert technical support and collection advice forever.</p>
            </div>
        </div>
    </div>
</div>

<style>
    /* Marquee Animation */
    @@keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    .animate-marquee {
        animation: marquee 30s linear infinite;
    }
    .animate-slide-left {
        animation: slideLeft 60s linear infinite;
    }
    @@keyframes slideLeft {
         0% { transform: translateX(0); }
        100% { transform: translateX(-10%); }
    }
    
    /* Fade In Up Utility */
    .animate-fade-in-up {
        animation: fadeInUp 1s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
    }
    @@keyframes fadeInUp {
        to { opacity: 1; transform: translateY(0); }
    }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
</style>

@section Scripts {
    <script>
        // Hero Parallax Effect (Mouse Move)
        const heroContent = document.getElementById('hero-content');
        const heroTitle1 = document.getElementById('hero-title-1');
        const heroTitle2 = document.getElementById('hero-title-2');

        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 50;
            const y = (window.innerHeight / 2 - e.pageY) / 50;
            
            if(heroContent) {
                 heroContent.style.transform = `translateX(${x}px) translateY(${y}px)`;
            }
             if(heroTitle1) {
                 heroTitle1.style.transform = `translateX(${-x * 1.5}px) translateY(${-y * 1.5}px)`;
            }
            if(heroTitle2) {
                 heroTitle2.style.transform = `translateX(${x * 2}px) translateY(${y * 2}px)`;
            }
            
            // BG Text Parallax
            const bgText = document.getElementById('bg-text-parallax');
            if(bgText) {
                const xBg = (window.innerWidth - e.pageX * 2) / 100;
                 bgText.style.transform = `translateX(${xBg}px)`;
            }
        });

        // 3D Tilt Effect for Cards with Vanilla JS
        const cards = document.querySelectorAll('.card-3d-wrapper');
        
        cards.forEach(card => {
            const cardInner = card.querySelector('.card-3d');
            
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const xCenter = rect.width / 2;
                const yCenter = rect.height / 2;
                
                // Rotation values (max 8deg)
                const rotateX = ((y - yCenter) / yCenter) * -8;
                const rotateY = ((x - xCenter) / xCenter) * 8;
                
                if(cardInner) {
                    cardInner.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
                }
            });
            
            card.addEventListener('mouseleave', () => {
                if(cardInner) {
                     cardInner.style.transform = 'rotateX(0) rotateY(0) scale(1)';
                }
            });
        });



        // Hero Carousel Logic
        let currentSlide = 0;
        const slides = document.querySelectorAll('.hero-slide');
        
        if(slides.length > 0) {
            setInterval(() => {
                // Hide current
                slides[currentSlide].classList.remove('opacity-100');
                slides[currentSlide].classList.add('opacity-0');
                
                // Next index
                currentSlide = (currentSlide + 1) % slides.length;
                
                // Show next
                slides[currentSlide].classList.remove('opacity-0');
                slides[currentSlide].classList.add('opacity-100');
            }, 6000); // 6 seconds per slide
        }
    </script>
}